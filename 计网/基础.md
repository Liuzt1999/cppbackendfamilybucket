#一、TCP/IP网络模型层数和功能
- 应用层：专注为用户提供应用功能如HTTP、FTP、Telnet、DNS等，不关心数据如何传输，在用户态工作，其它层在内核态。
- 传输层：为应用层提供网络支持（服务应用，实际的传输功能交给网络层）
    两个协议：TCP和UDP
        TCP（Transmission Control Protocol 传输控制协议），大部分应用使用TCP协议如HTTP，相较UDP多了流量控制、超时重                        传、拥塞控制等，保证可靠性。
        UDP只负责发送数据包，不保证能否抵达，实时性和效率好。（在应用层实现TCP特性可以使UDP实现可靠传输）
- 网络层：负责将数据从一个设备传到另一个设备
        IP协议（Internet Protocol）：将传输层的报文作为数据部分，加上IP头部组成IP报文，IP报文大小超过MTU（以太网中一般1500字节）会         再次分片。              
        IP地址给设备编号，IPv4协议：IP地址32位，分四段。一个IP地址被分成（配合子网掩码按位与）：
		网路号：标识该IP地址属于哪个子网
                主机号：标识同一子网下的不同主机
		寻址过程中先匹配网络号再寻找对应主机
- 网络接口层：为网络层提供链路级别传输服务，在以太网、WIFI这样的底层网络发送原始数据包，在这个层次上使用MAC地址来标识网络设备
        在IP头部前面加上MAC头，封装成数据帧发送到网络上
	MAC头包含接收方和发送方的MAC地址，可以通过ARP协议获取对方的MAC地址
			  
#二、键入网址到网页显示期间发生了什么
- HTTP：浏览器解析URL、生成HTTP请求信息
- DNS：查询服务器域名对应的IP地址
- TCP：建立连接、生成TCP报文
- IP：生成IP报文
- MAC：生成MAC报文
- 网卡：网卡驱动程序加上起始帧分界和FCS，通过网卡发往交换机
- 交换机：数据包通过交换机抵达路由器，即将离开子网
- 路由器：将数据包发往目的地
- 抵达后：检查MAC地址、解析IP头部确认IP和上层协议、解析TCP头判断序列号和端口号、HTTP进程解析请求报文封装响应报文

#三、Linux如何收发网络包

应用程序通过系统调用和Socket层进行数据交互

##接收过程

网卡接收到网络包 -> DMA技术写入Ring Buffer -> 网卡向CPU发起硬件中断唤醒硬件中断处理函数 -> 硬件中断处理函数屏蔽中断发起软中断恢复屏蔽的中断 -> 内核中的Ksoftirqd线程收到软中断后轮询处理数据 -> 从Ring Buffer中取出一个数据帧sk_buff作为网络包交给网络 -> 网络接口层检测报文合法性去除帧头帧尾交给网络层 -> 网络层取出IP包判断交给上层后去掉IP头交给传输层 -> 传输层取出TCP头根据源IP源端口目的IP目的端口作为标识将数据存入对应的Socket接收缓冲区 -> 应用层调用Socket接口取出数据拷贝到应用层缓冲区唤醒用户进程

##发送过程

应用程序调用Socket接口从用户态陷入内核态的Socket层内核申请一个sk_buff内存将用户要发送的数据拷贝到sk_buff并加入发送缓冲区 -> 网络协议栈从Socket发送缓冲区取出sk_buff按照TCP/IP协议栈从上到下处理 -> 对sk_buff的拷贝填充TCP头 -> 送往网络层选取路由、填充IP头、对超过MTU的数据包分片 -> 网络接口层通过ARP协议获得下一跳MAC地址填充头尾 -> 触发软中断网卡驱动程序将sk_buff挂到Ring Buffer


				
